import Link from "next/link"
import React, { useEffect, useRef, useCallback } from "react"

export const LonyLogoHeader = () => {
  const pathsRef = useRef<(SVGPathElement | null)[]>([]);
  const observerRef = useRef<IntersectionObserver | null>(null); 

  const setPathRef = useCallback((index: number) => (el: SVGPathElement | null) => {
    pathsRef.current[index] = el
  }, [])

  const animatePaths = useCallback(() => {
    import('gsap').then((gsap) => {
      pathsRef.current.forEach((path, index) => {
        if (path) {
          const length = path.getTotalLength();
          
          gsap.gsap.set(path, {
            strokeDasharray: length,
            strokeDashoffset: length,
            fill: 'none',
            strokeWidth: 5,
          });
  
          gsap.gsap.to(path, {
            strokeDashoffset: 0,
            duration: 2,
            delay: index * 0.5,
            ease: 'power2.inOut',
          })
  
          gsap.gsap.to(path, {
            fill: "#111",
            strokeWidth: 0,
            duration: 0.5,
            delay: 2 + index * 0.5,
            ease: 'power2.inOut',
          })
        }
      })
    })
  }, [])

  useEffect(() => {
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          animatePaths();
          observer.disconnect();
        }
      })
    }, { threshold: 0.1 });

    pathsRef.current.forEach(path => {
      if (path) {
        observer.observe(path);
      }
    })

    observerRef.current = observer;

    return () => {
      if (observerRef.current) {
        observerRef.current.disconnect();
      }
    }
  }, [animatePaths]);

  return (
    <Link href="/home" aria-label="Ir para a tela inicial">
      <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="469.000000pt" height="220.000000pt" viewBox="0 0 469.000000 220.000000" preserveAspectRatio="xMidYMid meet">
        <g transform="translate(0.000000,220.000000) scale(0.100000,-0.100000)" stroke="none">
          <path ref={setPathRef(0)} d="M2195 2108 c-22 -11 -107 -88 -190 -172 l-150 -151 -75 37 c-97 47 -263 102 -369 122 -96 18 -299 21 -387 5 -153 -27 -293 -94 -363 -174 -57 -65
          -76 -118 -76 -215 0 -76 3 -91 30 -139 52 -94 150 -160 302 -203 65 -19 104 -22 228 -23 83 0 169 3 193 8 23 4 42 4 42 -1 0 -11 -237 -252 -291 -295 l-46
          -37 -65 34 c-98 51 -161 62 -230 42 -129 -37 -148 -158 -32 -196 52 -17 198 -7 310 21 l92 23 126 -83 c224 -147 379 -213 527 -227 118 -10 255 20 344 77
          26 16 48 29 49 27 34 -78 70 -103 145 -103 177 1 389 244 417 477 l6 53 56 18 c53 17 172 93 188 120 5 6 -8 0 -27 -14 -55 -42 -117 -70 -169 -76 l-48 -6 -7
          34 c-10 48 -40 94 -70 107 -14 7 -49 12 -78 12 -153 0 -321 -177 -401 -422 -34 -105 -48 -129 -102 -177 -63 -55 -139 -83 -245 -89 -156 -8 -317 50 -557
          202 -111 71 -137 96 -96 96 49 0 104 60 283 309 l82 115 93 36 c168 66 291 146 417 270 l71 69 121 -59 c165 -80 262 -111 368 -118 148 -8 254 41 304 141
          l24 49 -27 28 c-30 31 -30 31 -51 -47 -13 -48 -52 -92 -108 -119 -57 -29 -204 -26 -303 4 -87 27 -216 82 -278 119 l-44 25 20 21 c38 42 114 168 143 240 34
          82 47 173 30 205 -15 29 -71 29 -126 0z m109 -63 c-1 -44 -10 -81 -34 -138 -31 -74 -142 -257 -156 -257 -15 0 -194 104 -194 113 0 13 106 144 174 216 86
          90 145 132 180 129 l31 -3 -1 -60z m-863 -125 c109 -23 220 -61 328 -111 l84 -39 -20 -23 c-11 -12 -111 -133 -221 -269 l-202 -247 -58 -8 c-31 -4 -124 -8
          -207 -8 -126 0 -163 4 -230 23 -105 31 -188 76 -235 129 -60 68 -74 107 -74 198 0 67 4 88 26 130 105 203 457 301 809 225z m564 -232 l93 -52 -19 -27
          c-24 -34 -107 -110 -181 -164 -86 -64 -311 -176 -325 -161 -2 2 56 86 128 187 185 257 193 268 202 269 5 0 51 -23 102 -52z m639 -520 c19 -30 30 -74 23 -93
          -9 -23 -60 0 -102 46 -39 44 -43 56 -17 62 46 12 82 7 96 -15z m-109 -45 c21 -50 51 -80 91 -93 39 -13 39 -13 -5 -146 -40 -119 -95 -209 -175 -290 -84 -84
          -139 -109 -185 -83 -17 10 -29 28 -36 53 -18 76 41 275 126 419 40 67 138 177 158 177 6 0 18 -17 26 -37z m-1585 -229 c72 -34 74 -36 55 -51 -11 -8 -47 -28
          -80 -44 -49 -24 -73 -29 -133 -29 -70 0 -109 10 -124 34 -16 24 -7 63 21 90 58 56 142 55 261 0z"/>
          <path ref={setPathRef(1)} d="M3324 1202 c-75 -26 -142 -73 -225 -157 -40 -41 -74 -73 -76 -71 -5 4 76 167 99 199 11 15 18 31 15 33 -9 9 -91 -32 -114 -57 -24 -27 -209 -411
          -229 -478 -8 -24 -14 -56 -14 -70 0 -33 19 -101 28 -101 4 0 16 28 27 62 26 82 97 224 160 318 97 145 275 297 338 288 47 -7 34 -50 -83 -280 -102 -200
          -110 -221 -110 -273 0 -51 3 -60 34 -91 31 -31 40 -34 91 -34 31 0 72 7 91 16 44 21 106 90 140 156 l28 53 7 -46 c9 -57 23 -85 50 -100 46 -24 128 18 199
          102 23 28 44 48 47 46 2 -3 -30 -73 -71 -155 -74 -147 -77 -151 -122 -171 -120 -54 -220 -129 -266 -200 -48 -76 -31 -127 40 -124 107 5 256 144 363 339
          12 22 36 37 97 62 159 65 240 138 311 279 17 34 31 70 31 80 0 10 -18 -19 -41 -65 -58 -119 -135 -194 -261 -257 -54 -27 -100 -46 -103 -43 -6 6 318 670 347
          711 26 36 19 42 -28 22 -59 -25 -82 -51 -139 -165 -132 -263 -303 -450 -352 -385 -34 48 -4 157 105 375 48 96 89 179 91 184 6 14 -42 -4 -82 -32 -44 -29
          -98 -129 -174 -316 -77 -193 -137 -277 -228 -322 -49 -23 -58 -25 -85 -14 -61 25 -53 108 26 264 31 61 81 157 110 214 68 130 72 182 17 211 -27 14 -28 14
          -89 -7z m336 -830 c0 -12 -84 -138 -126 -189 -44 -53 -109 -103 -136 -103 -10 0 -23 11 -29 24 -25 54 56 149 193 229 83 47 98 54 98 39z"/>
        </g>
      </svg>
    </Link>
  )
}